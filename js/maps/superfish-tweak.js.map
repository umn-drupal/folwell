{"version":3,"sources":["superfish-tweak.js"],"names":["Drupal","$","behaviors","superfishTweak","attach","menu","self","this","init","find","attr","removeTabIndex","document","on","mouseup","event","not","target","has","length","keyup","which","trigger","focusin","topLevel","parents","children","unbind","click touchstart","proxy","handleClick","keyup keydown","handleKey","siblings","parent","each","index","item","deInit","off","preventDefault","type","sfClicked","submenu","clicked","hasClass","removalTargets","jQuery"],"mappings":"CAAA,SAAUA,EAAQC,GAChBD,EAAOE,UAAUC,gBACfC,OAAQ,WACN,GAAIC,GAAOJ,EAAE,kBACXK,EAAOC,IACTA,MAAKC,KAAKH,GACVA,EACGI,KAAK,6BACLC,KAAK,gBAAiB,QACtBA,KAAK,gBAAiB,SACzBH,KAAKI,eAAeN,GACpBJ,EAAEW,UAAUC,IACVC,QAAS,SAASC,GACZV,EAAKW,IAAID,EAAME,SAA6C,IAAlCZ,EAAKa,IAAIH,EAAME,QAAQE,QACnDb,EAAKK,eAAeN,IAGxBe,MAAO,SAASL,GACM,KAAhBA,EAAMM,OACRpB,EAAEW,UAAUU,QAAQ,YAGxBC,QAAS,SAASR,GACsB,IAAlCV,EAAKa,IAAIH,EAAME,QAAQE,QACzBlB,EAAEW,UAAUU,QAAQ,eAM5Bd,KAAM,SAASH,GACb,GAEEmB,GAFElB,EAAOC,KACTkB,EAAUpB,EAAKqB,SAAS,gBAGtBD,GAAQN,OAAS,IACnBM,EAAQE,OAAO,yBACfF,EAAQhB,KAAK,kBAAkBkB,OAAO,cACtCH,EAAWC,EAAQC,SAAS,6BAC5BF,EAASX,IACPe,mBAAoB3B,EAAE4B,MAAMvB,EAAKwB,YAAaxB,GAC9CyB,gBAAiB9B,EAAE4B,MAAMvB,EAAK0B,UAAW1B,MAG7CD,EACGqB,SAAS,MACTA,SAAS,kBACThB,KAAK,WAAY,IAEpB,IAAIuB,GAAW5B,EACZ6B,OAAO,MACPD,SAAS,eACTP,SAAS,KACZO,GAASE,KAAK,SAASC,EAAOC,GAC5B,GAAIhC,GAAOJ,EAAEoC,EACb/B,GAAKgC,OAAOjC,MAIhBiC,OAAQ,SAASjC,GACfE,KAAKI,eAAeN,GACpBA,EACGI,KAAK,6BACL8B,IAAI,iBACJA,IAAI,mBAAoBtC,EAAE4B,MAAMtB,KAAKuB,YAAavB,QAGvDyB,UAAW,SAASjB,GACE,KAAhBA,EAAMM,OAAgC,KAAhBN,EAAMM,QAC9BN,EAAMyB,iBACa,UAAfzB,EAAM0B,MACRxC,EAAEc,EAAME,QAAQK,QAAQ,WAK9BQ,YAAa,SAASf,GACpB,GACE2B,GACAC,EAFEC,EAAU3C,EAAEc,EAAME,OAItByB,GAAYE,EAAQC,SAAS,cAC7BF,EAAUC,EAAQX,SAAS,MACvBS,GACFE,EACGV,OAAO,MACPD,SAAS,eACTP,SAAS,6BACThB,KAAK,gBAAiB,QACtBA,KAAK,gBAAiB,SACzBkC,EAAQlC,KAAK,gBAAiB,SAASA,KAAK,gBAAiB,QAC7DH,KAAKC,KAAKmC,KAEVC,EAAQlC,KAAK,gBAAiB,QAAQA,KAAK,gBAAiB,SAC5DH,KAAK+B,OAAOK,KAIhBhC,eAAgB,SAASN,GACvB,GAAIyC,EAEFA,GADEzC,EAAKwC,SAAS,iBACCxC,EAAKI,KAAK,0CAEVJ,EAAKI,KAAK,kBAE7BqC,EAAepC,KAAK,WAAY,SAGnCV,OAAQ+C","file":"../superfish-tweak.js","sourcesContent":["(function(Drupal, $) {\n  Drupal.behaviors.superfishTweak = {\n    attach: function() {\n      var menu = $(\".sf-horizontal\"),\n        self = this;\n      this.init(menu);\n      menu\n        .find(\"a.menuparent, span.nolink\")\n        .attr(\"aria-haspopup\", \"true\")\n        .attr(\"aria-expanded\", \"false\");\n      this.removeTabIndex(menu);\n      $(document).on({\n        mouseup: function(event) {\n          if (menu.not(event.target) && menu.has(event.target).length === 0) {\n            self.removeTabIndex(menu);\n          }\n        },\n        keyup: function(event) {\n          if (event.which === 27) {\n            $(document).trigger(\"mouseup\");\n          }\n        },\n        focusin: function(event) {\n          if (menu.has(event.target).length === 0) {\n            $(document).trigger(\"mouseup\");\n          }\n        }\n      });\n    },\n\n    init: function(menu) {\n      var self = this,\n        parents = menu.children(\"li.menuparent\"),\n        topLevel;\n      // Remove superfish's native hover behavior\n      if (parents.length > 0) {\n        parents.unbind(\"mouseenter mouseleave\");\n        parents.find(\"a, span.nolink\").unbind(\"focus blur\");\n        topLevel = parents.children(\"a.menuparent, span.nolink\");\n        topLevel.on({\n          \"click touchstart\": $.proxy(self.handleClick, self),\n          \"keyup keydown\": $.proxy(self.handleKey, self)\n        });\n      }\n      menu\n        .children(\"li\")\n        .children(\"a, span.nolink\")\n        .attr(\"tabindex\", \"0\");\n      // deInit any siblings\n      var siblings = menu\n        .parent(\"li\")\n        .siblings(\".menuparent\")\n        .children(\"ul\");\n      siblings.each(function(index, item) {\n        var menu = $(item);\n        self.deInit(menu);\n      });\n    },\n\n    deInit: function(menu) {\n      this.removeTabIndex(menu);\n      menu\n        .find(\"a.menuparent, span.nolink\")\n        .off(\"keyup keydown\")\n        .off(\"click touchstart\", $.proxy(this.handleClick, this));\n    },\n\n    handleKey: function(event) {\n      if (event.which === 32 || event.which === 13) {\n        event.preventDefault();\n        if (event.type === \"keyup\") {\n          $(event.target).trigger(\"click\");\n        }\n      }\n    },\n\n    handleClick: function(event) {\n      var clicked = $(event.target),\n        sfClicked,\n        submenu;\n      // Superfish applies class before we act here.\n      sfClicked = clicked.hasClass(\"sf-clicked\");\n      submenu = clicked.siblings(\"ul\");\n      if (sfClicked) {\n        clicked\n          .parent(\"li\")\n          .siblings(\".menuparent\")\n          .children(\"a.menuparent, span.nolink\")\n          .attr(\"aria-haspopup\", \"true\")\n          .attr(\"aria-expanded\", \"false\");\n        clicked.attr(\"aria-haspopup\", \"false\").attr(\"aria-expanded\", \"true\");\n        this.init(submenu);\n      } else {\n        clicked.attr(\"aria-haspopup\", \"true\").attr(\"aria-expanded\", \"false\");\n        this.deInit(submenu);\n      }\n    },\n\n    removeTabIndex: function(menu) {\n      var removalTargets;\n      if (menu.hasClass(\"sf-horizontal\")) {\n        removalTargets = menu.find(\".sf-depth-2 a, .sf-depth-2 span.nolink\");\n      } else {\n        removalTargets = menu.find(\"a, span.nolink\");\n      }\n      removalTargets.attr(\"tabindex\", \"-1\");\n    }\n  };\n})(Drupal, jQuery);\n"]}